<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI News Daily - Twitter ç²¾é€‰</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="bg-gradient"></div>
    
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <span class="logo-icon">ğŸ¤–</span>
                <h1>AI News Daily</h1>
            </div>
            <div class="header-meta">
                <span class="update-time" id="updateTime"></span>
                <button class="refresh-btn" onclick="refreshNews()">
                    <span>ğŸ”„</span> åˆ·æ–°
                </button>
            </div>
        </div>
    </header>

    <nav class="category-nav">
        <div class="category-container" id="categoryContainer">
            <button class="category-btn active" data-category="all">å…¨éƒ¨</button>
        </div>
    </nav>

    <div class="stats-bar" id="statsBar">
        <span class="stat-item">ğŸ“Š å…± <strong id="totalCount">0</strong> æ¡èµ„è®¯</span>
        <span class="stat-item">ğŸ• <span id="lastUpdate">-</span></span>
    </div>

    <main class="news-container">
        <div class="news-grid" id="newsGrid"></div>
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>åŠ è½½ä¸­...</p>
        </div>
        <div class="empty-state" id="emptyState" style="display: none;">
            <span class="empty-icon">ğŸ“­</span>
            <p>æš‚æ— èµ„è®¯</p>
        </div>
    </main>

    <footer class="footer">
        <p>ğŸ¤– Powered by AI â€¢ Data from GitHub/OpenAI/HuggingFace</p>
    </footer>

    <script>
        let currentCategory = 'all';
        let articles = [];
        
        // å›¾æ ‡æ˜ å°„
        const iconMap = {
            'model': 'ğŸ¤–',
            'tutorial': 'ğŸ“–',
            'tool': 'ğŸ› ï¸',
            'research': 'ğŸ“š',
            'industry': 'ğŸ”¥'
        };

        document.addEventListener('DOMContentLoaded', () => {
            loadData();
        });

        async function loadData() {
            showLoading(true);
            try {
                const response = await fetch('data.json');
                const data = await response.json();
                articles = data.articles || [];
                
                updateStats(data);
                initCategories(data.categories || []);
                renderNews();
            } catch (error) {
                console.error('åŠ è½½å¤±è´¥:', error);
                showEmpty();
            }
            showLoading(false);
        }

        function updateStats(data) {
            document.getElementById('totalCount').textContent = articles.length || data.categories?.reduce((sum, c) => sum + (c.count || 0), 0);
            document.getElementById('lastUpdate').textContent = data.lastUpdate || '-';
            document.getElementById('updateTime').textContent = new Date().toLocaleTimeString('zh-CN');
        }

        function initCategories(categories) {
            const container = document.getElementById('categoryContainer');
            
            categories.forEach(cat => {
                if (cat.count > 0) {
                    const btn = document.createElement('button');
                    btn.className = 'category-btn';
                    btn.dataset.category = cat.key;
                    
                    // æå–å›¾æ ‡
                    let icon = iconMap[cat.key] || 'ğŸ“Œ';
                    let name = cat.name.replace(/^[^\s]+\s*/, '');
                    
                    btn.innerHTML = `${icon} ${name} <span class="count">${cat.count}</span>`;
                    btn.onclick = () => filterCategory(cat.key);
                    container.appendChild(btn);
                }
            });
        }

        function filterCategory(category) {
            currentCategory = category;
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.category === category);
            });
            renderNews();
        }

        function renderNews() {
            const grid = document.getElementById('newsGrid');
            
            // è¿‡æ»¤
            let filtered = currentCategory === 'all' 
                ? articles 
                : articles.filter(a => a.category === currentCategory);
            
            if (filtered.length === 0) {
                showEmpty();
                return;
            }
            
            hideEmpty();
            grid.innerHTML = filtered.map(article => createCard(article)).join('');
            animateCards();
        }

        function createCard(article) {
            const tags = (article.tags || []).slice(0, 3).map(t => 
                `<span class="tag">${t}</span>`
            ).join('');
            
            // è·å–å›¾æ ‡
            let icon = iconMap[article.category] || 'ğŸ“Œ';
            let catName = (article.category_name || '').replace(/^[^\s]+\s*/, '') || 'èµ„è®¯';
            
            // æ¸…ç†æ‘˜è¦ä¸­çš„ HTML
            let summary = article.summary || '';
            summary = summary.replace(/<[^>]+>/g, '').substring(0, 200);
            
            return `
                <article class="news-card" onclick="openLink('${article.url}')">
                    <div class="card-header">
                        <span class="source-badge">${article.source || 'Web'}</span>
                        <span class="date">${formatDate(article.date)}</span>
                    </div>
                    <h3 class="card-title">${escapeHtml(article.title)}</h3>
                    <p class="card-summary">${escapeHtml(summary)}</p>
                    <div class="card-footer">
                        <div class="tags">${tags}</div>
                        <span class="category-tag">${icon} ${catName}</span>
                    </div>
                </article>
            `;
        }

        function formatDate(dateStr) {
            if (!dateStr) return '';
            if (dateStr.includes(',')) {
                // Wed, 28 Jan 2026 æ ¼å¼
                const parts = dateStr.split(' ');
                if (parts.length >= 3) {
                    return `${parts[2]}-${getMonth(parts[1])}-${parts[0]}`;
                }
            }
            return dateStr.substring(0, 10);
        }

        function getMonth(m) {
            const months = {'Jan': '01', 'Feb': '02', 'Mar': '03', 'Apr': '04', 
                          'May': '05', 'Jun': '06', 'Jul': '07', 'Aug': '08',
                          'Sep': '09', 'Oct': '10', 'Nov': '11', 'Dec': '12'};
            return months[m] || '01';
        }

        function openLink(url) {
            window.open(url, '_blank');
        }

        async function refreshNews() {
            const btn = document.querySelector('.refresh-btn');
            btn.disabled = true;
            btn.innerHTML = '<span>â³</span> åŠ è½½ä¸­...';
            
            try {
                // è§¦å‘åç«¯æ›´æ–°
                await fetch('/.netlify/functions/update', { method: 'POST' }).catch(() => {});
                await loadData();
            } catch (e) {
                console.log('åˆ·æ–°å®Œæˆ');
            }
            
            btn.disabled = false;
            btn.innerHTML = '<span>ğŸ”„</span> åˆ·æ–°';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function showEmpty() {
            document.getElementById('newsGrid').style.display = 'none';
            document.getElementById('emptyState').style.display = 'flex';
        }

        function hideEmpty() {
            document.getElementById('newsGrid').style.display = 'grid';
            document.getElementById('emptyState').style.display = 'none';
        }

        function animateCards() {
            const cards = document.querySelectorAll('.news-card');
            cards.forEach((card, i) => {
                card.style.animationDelay = `${i * 0.05}s`;
            });
        }
    </script>
</body>
</html>
