name: AI News Daily Update

on:
  # æ¯å¤©æ—©ä¸Š 8 ç‚¹è‡ªåŠ¨è¿è¡Œ
  schedule:
    - cron: '0 8 * * *'
  
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
  
  # ä»£ç æ¨é€æ—¶ä¹Ÿå¯ä»¥è§¦å‘ï¼ˆå¯é€‰ï¼‰
  push:
    branches: [main]
    paths:
      - '**.py'
      - 'data.json'

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  update-news:
    runs-on: ubuntu-latest
    
    steps:
      # 1. æ£€å‡ºä»£ç 
      - name: Checkout code
        uses: actions/checkout@v4
      
      # 2. è®¾ç½® Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
      
      # 3. å®‰è£…ä¾èµ–
      - name: Install dependencies
        run: |
          pip install requests --quiet
      
      # 4. è¿è¡Œæ–°é—»æŠ“å–è„šæœ¬
      - name: Fetch AI News
        env:
          TAVILY_API_KEY: ${{ secrets.TAVILY_API_KEY }}
        run: |
          python fetch_news.py
      
      # 5. æäº¤æ›´æ”¹
      - name: Commit changes
        run: |
          if [[ $(git diff --stat) != "" ]]; then
            git config user.name "github-actions[bot]"
            git config user.email "github-actions[bot]@users.noreply.github.com"
            git add data.json
            git commit -m "ğŸ¤– Auto-update AI news - $(date '+%Y-%m-%d %H:%M')"
            git push
            echo "âœ… News updated and pushed to GitHub"
          else
            echo "No changes to commit"
          fi

  # å¦‚æœéœ€è¦éƒ¨ç½²åˆ° Vercelï¼Œå–æ¶ˆæ³¨é‡Šä»¥ä¸‹éƒ¨åˆ†
  # deploy-vercel:
  #   runs-on: ubuntu-latest
  #   needs: update-news
  #   if: github.ref == 'refs/heads/main'
  #   
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v4
  #     
  #     - name: Deploy to Vercel
  #       uses: amondnet/vercel-action@v25
  #       with:
  #         vercel-token: ${{ secrets.VERCEL_TOKEN }}
  #         vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
  #         vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
  #         vercel-args: '--prod'
